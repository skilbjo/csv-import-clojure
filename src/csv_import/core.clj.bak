(ns csv-import.core
  (:require [clojure.java.io :as io]
            [clojure-csv.core :as csv]
            [clojure.java.jdbc :as sql])
  (:gen-class))

(def filepath "./data/direct_mail.promocodes2.csv")

(def db {:subprotocol "postgresql"
         :subname "//localhost:5432/clojure"
         :user "john.skilbeck"})

(defn insert-db [row]
  (sql/insert! db 
              :promocodes2 {:model row}))

(defn parse [file]
  (insert-db
    (csv/parse-csv file)))

;(defn open-file [fname]  
;  (with-open [file (io/reader fname)] 
;    (doall (map (comp first csv/parse-csv) (line-seq file))))) 

(defn open-file [fname]  
  (with-open [file (io/reader fname)] 
    (parse file)))

(defn -main [& args]
  (->
    filepath
    open-file
    ))

